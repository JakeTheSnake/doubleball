(function() {

$(document).ready(function() {
    var GCWidth = 1000;
    var GCHeight = 650;
    try {
        GameCreator.height = window.gon.game.height || GCHeight;
        GameCreator.width = window.gon.game.width || GCWidth;
    } catch (e) {
        GameCreator.height = GCHeight;
        GameCreator.width = GCWidth;
    }

    createSplash();
    createSplashOverlay();

    GameCreator.bgCanvas = document.createElement("canvas");
    GameCreator.bgCanvas.id = "bg-canvas"
    GameCreator.bgContext = GameCreator.bgCanvas.getContext("2d");
    GameCreator.bgCanvas.width = GameCreator.width;
    GameCreator.bgCanvas.height = GameCreator.height;
    $("#canvas-container").append(GameCreator.bgCanvas);

    GameCreator.mainCanvas = document.createElement("canvas");
    GameCreator.mainCanvas.id = "main-canvas"
    GameCreator.mainContext = GameCreator.mainCanvas.getContext("2d");
    GameCreator.mainCanvas.width = GameCreator.width;
    GameCreator.mainCanvas.height = GameCreator.height;
    $("#canvas-container").append(GameCreator.mainCanvas);

   
    GameCreator.state = 'playing';
    GameCreator.engineOnly = true;

    GameCreator.initialize();

    if (window.gon && gon.game != null) {
        GameCreator.restoreState(gon.game);
    }
    /*
    var getQueryParam = function(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    };
    if (window.gon && gon.game != null) {
        GameCreator.restoreState(gon.game);
        setTimeout(GameCreator.playGame, 0);
        if (gon.gameId === 2 && ) {
            var a = getQueryParam('a');
            setTimeout(function() {
                if (false) { // Replace with check if score should be sent.
                    var s = 5; // Replace with the score counter value.
                    var url = 'http://www.what.se/?a=' + a + '&s=' + btoa(s); // Score should be base64-encoded
                    document.location.href = url;
                }
            })
        }
    }
    */

    
});
    
var createSplash = function() {
    var splash = document.getElementById('splash');
    splash.style.width = GameCreator.width + "px";
    splash.style.height = GameCreator.height + "px";
    var splashTitle = document.createElement('h2');
    var divider = document.createElement('span');
    divider.innerHTML = "<br/><br/><br/></br>";
    splashTitle.innerHTML = gon.gameName;
    var playButton = document.createElement('a');
    playButton.innerHTML = "&#9658;";
    playButton.href = "#";
    playButton.onclick = function() {
        $('#splash').hide();
        $('#splash-overlay').hide();
        GameCreator.playGame();
    }
    var madeBy = document.createElement('p');
    madeBy.innerHTML = "made using";
    var afLogo = document.createElement('img');
    afLogo.src = "<%= asset_path 'generic/header_logo.png' %>";
    splash.appendChild(splashTitle);
    splash.appendChild(playButton);
    splash.appendChild(divider);
    splash.appendChild(madeBy);
    splash.appendChild(afLogo);
}

var createSplashOverlay = function() {
    var splash = document.getElementById('splash');
    var overlay = document.createElement('div');
    overlay.id = 'splash-overlay';
    overlay.style.width = GameCreator.width + "px";
    overlay.style.height = GameCreator.height + "px";
    splash.parentElement.appendChild(overlay);
}

})();
